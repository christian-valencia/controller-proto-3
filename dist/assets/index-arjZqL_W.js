(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();const A={LS_X:0,LS_Y:1,RS_X:2,RS_Y:3},V={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,VIEW:8,MENU:9,LS:10,RS:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16};class W{prev=new Map;now=new Map;deadzone=.18;triggerThreshold=.2;indexOfFirst=null;constructor(){window.addEventListener("gamepadconnected",e=>{this.indexOfFirst===null&&(this.indexOfFirst=e.gamepad.index)}),window.addEventListener("gamepaddisconnected",e=>{const s=e.gamepad.index;this.indexOfFirst===s&&(this.indexOfFirst=null)})}first(){const e=navigator.getGamepads();for(const s of e)if(s)return s;return null}update(){this.prev=new Map(this.now),this.now.clear();const e=navigator.getGamepads();for(const s of e)s&&this.now.set(s.index,s)}btnValue(e,s){const n=e.buttons[V[s]];return n?s==="LT"||s==="RT"?n.value>=this.triggerThreshold?n.value:0:n.pressed?1:0:0}isDown(e,s=0){const n=this.now.get(s);return n?this.btnValue(n,e)>0:!1}justPressed(e,s=0){const n=this.now.get(s),i=this.prev.get(s);if(!n)return!1;const a=this.btnValue(n,e)>0,u=i?this.btnValue(i,e)>0:!1;return a&&!u}justReleased(e,s=0){const n=this.now.get(s),i=this.prev.get(s);if(!n)return!1;const a=this.btnValue(n,e)>0,u=i?this.btnValue(i,e)>0:!1;return!a&&u}getStick(e,s=0){const n=this.now.get(s);if(!n)return{x:0,y:0,magnitude:0};const i=e==="LEFT"?A.LS_X:A.RS_X,a=e==="LEFT"?A.LS_Y:A.RS_Y;let u=n.axes[i]??0,h=n.axes[a]??0;h=-h;const m=Math.hypot(u,h);if(m<this.deadzone)return{x:0,y:0,magnitude:0};const P=(m-this.deadzone)/(1-this.deadzone),k=P/(m||1);return{x:u*k,y:h*k,magnitude:P}}}const I={a:"A",A:"A",s:"B",S:"B",d:"X",D:"X",w:"Y",W:"Y",j:"A",J:"A",l:"B",L:"B",i:"Y",I:"Y",k:"X",K:"X",ArrowUp:"UP",ArrowDown:"DOWN",ArrowLeft:"LEFT",ArrowRight:"RIGHT",q:"LB",Q:"LB",e:"RB",E:"RB",z:"LT",Z:"LT",c:"RT",C:"RT",v:"LS",V:"LS",n:"RS",N:"RS",Tab:"VIEW",Enter:"MENU",Escape:"HOME"};class X{keysDown=new Set;prevKeysDown=new Set;leftStick={x:0,y:0};rightStick={x:0,y:0};constructor(){window.addEventListener("keydown",e=>{this.keysDown.add(e.key),this.updateSticks()}),window.addEventListener("keyup",e=>{this.keysDown.delete(e.key),this.updateSticks()}),window.addEventListener("keydown",e=>{(I[e.key]||e.key==="Tab")&&e.preventDefault()})}updateSticks(){let e=0,s=0;this.keysDown.has("Control")&&((this.keysDown.has("a")||this.keysDown.has("A"))&&(e-=1),(this.keysDown.has("d")||this.keysDown.has("D"))&&(e+=1),(this.keysDown.has("w")||this.keysDown.has("W"))&&(s+=1),(this.keysDown.has("s")||this.keysDown.has("S"))&&(s-=1));let i=0,a=0;this.keysDown.has("Alt")&&((this.keysDown.has("j")||this.keysDown.has("J"))&&(i-=1),(this.keysDown.has("l")||this.keysDown.has("L"))&&(i+=1),(this.keysDown.has("i")||this.keysDown.has("I"))&&(a+=1),(this.keysDown.has("k")||this.keysDown.has("K"))&&(a-=1)),this.leftStick={x:e,y:s},this.rightStick={x:i,y:a}}update(){this.prevKeysDown=new Set(this.keysDown)}isDown(e){for(const[s,n]of Object.entries(I))if(n===e&&this.keysDown.has(s))return!0;return!1}justPressed(e){if(!this.isDown(e))return!1;for(const[n,i]of Object.entries(I))if(i===e&&this.prevKeysDown.has(n))return!1;return!0}justReleased(e){if(this.isDown(e))return!1;for(const[n,i]of Object.entries(I))if(i===e&&this.prevKeysDown.has(n))return!0;return!1}getStick(e){const s=e==="LEFT"?this.leftStick:this.rightStick,n=Math.hypot(s.x,s.y);return n>1?{x:s.x/n,y:s.y/n,magnitude:1}:{x:s.x,y:s.y,magnitude:n}}getKeyMappings(){return{...I}}}class J{gamepadManager;keyboardManager;constructor(){this.gamepadManager=new W,this.keyboardManager=new X}update(){this.gamepadManager.update(),this.keyboardManager.update()}isDown(e,s=0){return this.gamepadManager.isDown(e,s)||this.keyboardManager.isDown(e)}justPressed(e,s=0){return this.gamepadManager.justPressed(e,s)||this.keyboardManager.justPressed(e)}justReleased(e,s=0){return this.gamepadManager.justReleased(e,s)||this.keyboardManager.justReleased(e)}getStick(e,s=0){const n=this.gamepadManager.getStick(e,s);return n.magnitude>.1?n:this.keyboardManager.getStick(e)}get gamepad(){return this.gamepadManager}get keyboard(){return this.keyboardManager}firstGamepad(){return this.gamepadManager.first()}getActiveInputMethod(){const e=this.gamepadManager.first()!==null,s=this.keyboardManager.getStick("LEFT").magnitude>0||this.keyboardManager.getStick("RIGHT").magnitude>0||Object.values(this.keyboardManager.getKeyMappings()).some(n=>this.keyboardManager.isDown(n));return e&&s?"both":e?"gamepad":s?"keyboard":"none"}}document.getElementById("windows-shell");document.getElementById("lock-screen");const O=document.getElementById("system-tray"),H=document.getElementById("switcher"),T=document.getElementById("clock"),U=document.getElementById("clock2"),F=document.getElementById("auth");document.getElementById("auth-text-left");document.getElementById("auth-text-right");document.getElementById("progress-ring");const w=document.getElementById("progress-circle");document.getElementById("hud-container");document.getElementById("status-container");document.getElementById("debug-container");const q=document.getElementById("green"),z=document.getElementById("blue"),Q=document.getElementById("orange"),N=[q,z,Q],R=["green","blue","orange"],o=new J,d={LOCKED:"locked",SHELL:"shell",MENU:"menu",APP:"app"};let f=d.LOCKED,g=0,c=0;const v=300;let b=!1,$=0;const Z=300;let r="preview",p=0;const y=["library","settings","notifications","gallery"];let B=!1,j=0;const ee=700;window.addEventListener("keydown",t=>{t.key.toLowerCase()==="f"&&x()});function x(){document.fullscreenElement?document.exitFullscreen().catch(console.error):document.documentElement.requestFullscreen().catch(console.error)}function K(){o.update(),te(),oe(),requestAnimationFrame(K)}function te(){switch(console.log(`handleInputActions called - currentUIState: ${f}`),f){case d.LOCKED:console.log("Handling LOCKED state inputs"),se();break;case d.SHELL:console.log("Handling SHELL state inputs"),re();break;case d.MENU:console.log("Handling MENU state inputs"),ce();break;case d.APP:console.log("Handling APP state inputs"),de();break;default:console.warn("Unknown UI state:",f);break}o.justPressed("VIEW")&&(console.log("View button pressed - global action"),x()),o.justPressed("MENU")&&f===d.LOCKED&&x()}function se(){if(f!==d.LOCKED)return;const t=o.isDown("Y");if(t&&!B)B=!0,j=Date.now(),w&&(w.style.transition="none",w.style.strokeDashoffset="100.53");else if(t&&B){const e=Date.now()-j,s=Math.min(e/ee,1);if(w){const i=100.53*(1-s);w.style.strokeDashoffset=i.toString()}s>=1&&ne()}else!t&&B&&G()}function ne(){console.log("Hold complete! Authentication action triggered."),b=!1,M(d.SHELL),C();const t=document.getElementById("shell-nav");t&&t.classList.add("visible");const e=document.getElementById("focus");e&&(e.classList.add("visible"),setTimeout(()=>{D()},100)),F&&F.classList.add("fade-out"),G(),l.confirmation(),console.log("Lock screen unlocked! Shell interactions now active.")}function G(){f===d.LOCKED&&(B=!1,j=0,w&&(w.style.transition="stroke-dashoffset 0.2s ease",w.style.strokeDashoffset="100.53"))}function oe(){ie(),Y()}function Y(){const t=f!==d.LOCKED;O&&(O.className=t?"unlocked":"locked"),H&&(H.className=t?"unlocked":"locked"),T&&(t?T.classList.add("hidden"):T.classList.remove("hidden"))}function ie(){const t=new Date;let e=t.getHours();const s=t.getMinutes();e===0?e=12:e>12&&(e=e-12);const n=`${e}:${s.toString().padStart(2,"0")}`;T&&(T.textContent=n),U&&(U.textContent=n)}async function L(t=1,e=200){const s=o.firstGamepad();if(!s)return;const n=s.vibrationActuator;if(n)try{await n.playEffect("dual-rumble",{duration:e,strongMagnitude:t,weakMagnitude:t})}catch(i){console.warn("Rumble not supported:",i)}}const l={lightTap:()=>L(.2,50),confirmation:()=>L(.8,200),navigation:()=>L(.1,30),error:()=>L(.6,100),menuToggle:()=>L(.4,150),selectionChange:()=>L(.15,25)};function M(t){console.log(`UI State: ${f} → ${t}`),f=t,Y(),C()}function E(t){console.log(`navigateApps called with direction: ${t}`),console.log(`Current state: ${f}, selectedAppIndex: ${g}`);const e=g;t==="right"?g=(g+1)%N.length:t==="left"&&(g=(g-1+N.length)%N.length),console.log(`App Navigation: ${R[e]} → ${R[g]}`),C(),l.selectionChange()}function S(t){console.log(`navigateShellNav called with direction: ${t}`),console.log(`Current selectedNavIndex: ${p} (${y[p]})`);const e=p;t==="right"?p=(p+1)%y.length:t==="left"&&(p=(p-1+y.length)%y.length),console.log(`Shell Nav Navigation: ${y[e]} → ${y[p]}`),D(),l.selectionChange()}function C(){if(console.log(`updateAppStates called - currentUIState: ${f}, selectedAppIndex: ${g}`),f!==d.SHELL){console.log("Not updating app states - not in SHELL state");return}N.forEach((t,e)=>{t&&(e===g?(console.log(`Setting ${R[e]} to active`),t.classList.add("app-active"),t.classList.remove("app-rest")):(console.log(`Setting ${R[e]} to rest`),t.classList.add("app-rest"),t.classList.remove("app-active")))}),ae()}function ae(){console.log(`updatePreviewPositions called - selectedAppIndex: ${g}`);const t=[document.getElementById("green-preview"),document.getElementById("blue-preview"),document.getElementById("orange-preview")];switch(t.forEach(e=>{e&&e.classList.remove("preview-center","preview-left","preview-right","preview-far-left","preview-far-right","preview-scaled")}),b=!1,g){case 0:t[0]?.classList.add("preview-center"),t[1]?.classList.add("preview-right"),t[2]?.classList.add("preview-far-right");break;case 1:t[0]?.classList.add("preview-left"),t[1]?.classList.add("preview-center"),t[2]?.classList.add("preview-right");break;case 2:t[0]?.classList.add("preview-far-left"),t[1]?.classList.add("preview-left"),t[2]?.classList.add("preview-center");break}D()}function le(){const e=[document.getElementById("green-preview"),document.getElementById("blue-preview"),document.getElementById("orange-preview")][g];e&&(b?(e.classList.remove("preview-scaled"),b=!1):(e.classList.add("preview-scaled"),b=!0),D(),l.confirmation())}function D(){const t=document.getElementById("focus");if(t){if(r==="preview"){t.classList.remove("focus-nav"),t.classList.add("focus-preview");const s=[document.getElementById("green-preview"),document.getElementById("blue-preview"),document.getElementById("orange-preview")][g];if(!s)return;s.classList.contains("preview-scaled")?(t.style.width="100vw",t.style.height="100vh"):(t.style.width="50vw",t.style.height="50vh"),t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)"}else if(r==="shell-nav"){t.classList.remove("focus-preview"),t.classList.add("focus-nav");const e=document.getElementById(y[p]);if(!e)return;const s=e.getBoundingClientRect(),n=document.getElementById("windows-shell").getBoundingClientRect();t.style.width="64px",t.style.height="64px",t.style.top=`${s.top-n.top+s.height/2}px`,t.style.left=`${s.left-n.left+s.width/2}px`,t.style.transform="translate(-50%, -50%)"}}}function re(){console.log("Shell inputs active - ready for desktop interactions!");const t=Date.now(),e={LEFT:o.isDown("LEFT"),RIGHT:o.isDown("RIGHT"),LB:o.isDown("LB"),RB:o.isDown("RB"),leftJust:o.justPressed("LEFT"),rightJust:o.justPressed("RIGHT"),lbJust:o.justPressed("LB"),rbJust:o.justPressed("RB")};Object.values(e).some(_=>_)&&console.log("Input detected:",e);const n=o.justPressed("LEFT"),i=o.justPressed("RIGHT"),a=o.justPressed("LB"),u=o.justPressed("RB");(n||i||a||u)&&console.log("Navigation input detected:",{leftPressed:n,rightPressed:i,lbPressed:a,rbPressed:u}),(o.justPressed("LEFT")||o.isDown("LEFT")&&t-c>v)&&(console.log("LEFT input detected"),r==="preview"?(console.log("Navigating apps left"),E("left")):r==="shell-nav"&&(console.log("Navigating shell-nav left"),S("left")),c=t),(o.justPressed("RIGHT")||o.isDown("RIGHT")&&t-c>v)&&(console.log("RIGHT input detected"),r==="preview"?(console.log("Navigating apps right"),E("right")):r==="shell-nav"&&(console.log("Navigating shell-nav right"),S("right")),c=t),(o.justPressed("LB")||o.isDown("LB")&&t-c>v)&&(console.log("LB input detected"),r==="preview"?(console.log("Navigating apps left"),E("left")):r==="shell-nav"&&(console.log("Navigating shell-nav left"),S("left")),c=t),(o.justPressed("RB")||o.isDown("RB")&&t-c>v)&&(console.log("RB input detected"),r==="preview"?(console.log("Navigating apps right"),E("right")):r==="shell-nav"&&(console.log("Navigating shell-nav right"),S("right")),c=t);const h=o.getStick("LEFT"),m=Date.now();h.magnitude>.6&&m-c>v&&(h.x>.6?(r==="preview"?E("right"):r==="shell-nav"&&S("right"),c=m):h.x<-.6&&(r==="preview"?E("left"):r==="shell-nav"&&S("left"),c=m)),(o.justPressed("DOWN")||o.isDown("DOWN")&&t-c>v)&&(console.log("DOWN input detected - moving focus to shell-nav"),r==="preview"&&(r="shell-nav",p=0,D(),c=t)),(o.justPressed("UP")||o.isDown("UP")&&t-c>v)&&(console.log("UP input detected - moving focus back to preview"),r==="shell-nav"&&(r="preview",D(),c=t)),o.justPressed("UP")&&(console.log("Navigate UP - future functionality"),l.navigation()),o.justPressed("DOWN")&&(console.log("Navigate DOWN - future functionality"),l.navigation());const P=Date.now();o.isDown("A")&&P-$>Z&&($=P,r==="preview"?le():r==="shell-nav"&&(console.log("Shell Nav: A button - Reserved for shell navigation action"),l.confirmation())),o.justPressed("B")&&(console.log("Shell: B button - Back/Cancel"),l.lightTap()),o.justPressed("X")&&(console.log("Shell: X button - Context action"),l.lightTap()),o.justPressed("Y")&&(console.log("Shell: Y button - Alternative action"),l.lightTap()),o.justPressed("LT")&&(console.log("Shell: LT - Previous app"),l.menuToggle()),o.justPressed("RT")&&(console.log("Shell: RT - Next app"),l.menuToggle());const k=o.getStick("RIGHT");k.magnitude>.3&&console.log(`Shell: Right stick scrolling - x:${k.x.toFixed(2)}, y:${k.y.toFixed(2)}`),o.justPressed("LS")&&(console.log("Shell: Left stick click - Quick action"),l.lightTap()),o.justPressed("RS")&&(console.log("Shell: Right stick click - Context menu"),l.lightTap()),o.justPressed("MENU")&&(console.log("Shell: Opening main menu"),M(d.MENU),l.menuToggle())}function ce(){console.log("Menu inputs active - navigating menu system!"),o.justPressed("UP")&&(console.log("Menu: Navigate up"),l.selectionChange()),o.justPressed("DOWN")&&(console.log("Menu: Navigate down"),l.selectionChange()),o.justPressed("A")&&(console.log("Menu: Select item"),l.confirmation()),o.justPressed("B")&&(console.log("Menu: Back to shell"),M(d.SHELL),l.menuToggle()),o.justPressed("MENU")&&(console.log("Menu: Closing menu"),M(d.SHELL),l.menuToggle())}function de(){console.log("App inputs active - app-specific controls!"),o.justPressed("B")&&(console.log("App: Back to shell"),M(d.SHELL),l.lightTap())}requestAnimationFrame(K);
