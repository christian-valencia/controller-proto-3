(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();const de={LS_X:0,LS_Y:1,RS_X:2,RS_Y:3},Ge={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,VIEW:8,MENU:9,LS:10,RS:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16};class Ke{prev=new Map;now=new Map;deadzone=.18;triggerThreshold=.2;indexOfFirst=null;constructor(){console.log("ðŸŽ® GamepadManager initialized"),window.addEventListener("gamepadconnected",e=>{console.log("ðŸŽ® GAMEPAD CONNECTED:",e.gamepad.id),this.indexOfFirst===null&&(this.indexOfFirst=e.gamepad.index)}),window.addEventListener("gamepaddisconnected",e=>{console.log("ðŸŽ® GAMEPAD DISCONNECTED:",e.gamepad.id);const s=e.gamepad.index;this.indexOfFirst===s&&(this.indexOfFirst=null)})}first(){const e=navigator.getGamepads();for(const s of e)if(s)return s;return null}update(){this.prev=new Map(this.now),this.now.clear();const e=navigator.getGamepads();for(const s of e)s&&this.now.set(s.index,s)}btnValue(e,s){const n=e.buttons[Ge[s]];return n?s==="LT"||s==="RT"?n.value>=this.triggerThreshold?n.value:0:n.pressed?1:0:0}isDown(e,s=0){let n=this.now.get(s);if(!n){for(const[i,l]of this.now.entries())if(l){n=l;break}}return n?this.btnValue(n,e)>0:!1}justPressed(e,s=0){let n=this.now.get(s),i=this.prev.get(s);if(!n){for(const[f,r]of this.now.entries())if(r){n=r,i=this.prev.get(f);break}}if(!n)return!1;const l=this.btnValue(n,e)>0,c=i?this.btnValue(i,e)>0:!1;return l&&!c}justReleased(e,s=0){let n=this.now.get(s),i=this.prev.get(s);if(!n){for(const[f,r]of this.now.entries())if(r){n=r,i=this.prev.get(f);break}}if(!n)return!1;const l=this.btnValue(n,e)>0,c=i?this.btnValue(i,e)>0:!1;return!l&&c}getStick(e,s=0){let n=this.now.get(s);if(!n){for(const[be,G]of this.now.entries())if(G){n=G;break}}if(!n)return{x:0,y:0,magnitude:0};const i=e==="LEFT"?de.LS_X:de.RS_X,l=e==="LEFT"?de.LS_Y:de.RS_Y;let c=n.axes[i]??0,f=n.axes[l]??0;f=-f;const r=Math.hypot(c,f);if(r<this.deadzone)return{x:0,y:0,magnitude:0};const g=(r-this.deadzone)/(1-this.deadzone),L=g/(r||1);return{x:c*L,y:f*L,magnitude:g}}}const K={a:"A",A:"A",s:"B",S:"B",d:"X",D:"X",w:"Y",W:"Y",j:"A",J:"A",l:"B",L:"B",i:"Y",I:"Y",k:"X",K:"X",ArrowUp:"UP",ArrowDown:"DOWN",ArrowLeft:"LEFT",ArrowRight:"RIGHT",q:"LB",Q:"LB",e:"RB",E:"RB",z:"LT",Z:"LT",c:"RT",C:"RT",v:"LS",V:"LS",n:"RS",N:"RS",Tab:"VIEW",Enter:"MENU",Escape:"HOME"};class Ye{keysDown=new Set;prevKeysDown=new Set;leftStick={x:0,y:0};rightStick={x:0,y:0};constructor(){window.addEventListener("keydown",e=>{(K[e.key]||e.key==="Tab")&&e.preventDefault(),this.keysDown.add(e.key),this.updateSticks()}),window.addEventListener("keyup",e=>{(K[e.key]||e.key==="Tab")&&e.preventDefault(),this.keysDown.delete(e.key),this.updateSticks()})}updateSticks(){let e=0,s=0;this.keysDown.has("Control")&&((this.keysDown.has("a")||this.keysDown.has("A"))&&(e-=1),(this.keysDown.has("d")||this.keysDown.has("D"))&&(e+=1),(this.keysDown.has("w")||this.keysDown.has("W"))&&(s+=1),(this.keysDown.has("s")||this.keysDown.has("S"))&&(s-=1));let i=0,l=0;this.keysDown.has("Alt")&&((this.keysDown.has("j")||this.keysDown.has("J"))&&(i-=1),(this.keysDown.has("l")||this.keysDown.has("L"))&&(i+=1),(this.keysDown.has("i")||this.keysDown.has("I"))&&(l+=1),(this.keysDown.has("k")||this.keysDown.has("K"))&&(l-=1)),this.leftStick={x:e,y:s},this.rightStick={x:i,y:l}}update(){this.prevKeysDown=new Set(this.keysDown)}isDown(e){for(const[s,n]of Object.entries(K))if(n===e&&this.keysDown.has(s))return!0;return!1}justPressed(e){if(!this.isDown(e))return!1;for(const[n,i]of Object.entries(K))if(i===e&&this.prevKeysDown.has(n))return!1;return!0}justReleased(e){if(this.isDown(e))return!1;for(const[n,i]of Object.entries(K))if(i===e&&this.prevKeysDown.has(n))return!0;return!1}getStick(e){const s=e==="LEFT"?this.leftStick:this.rightStick,n=Math.hypot(s.x,s.y);return n>1?{x:s.x/n,y:s.y/n,magnitude:1}:{x:s.x,y:s.y,magnitude:n}}getKeyMappings(){return{...K}}}class We{gamepadManager;keyboardManager;constructor(){this.gamepadManager=new Ke,this.keyboardManager=new Ye}update(){this.gamepadManager.update(),this.keyboardManager.update()}isDown(e,s=0){return this.gamepadManager.isDown(e,s)||this.keyboardManager.isDown(e)}justPressed(e,s=0){return this.gamepadManager.justPressed(e,s)||this.keyboardManager.justPressed(e)}justReleased(e,s=0){return this.gamepadManager.justReleased(e,s)||this.keyboardManager.justReleased(e)}getStick(e,s=0){const n=this.gamepadManager.getStick(e,s);return n.magnitude>.1?n:this.keyboardManager.getStick(e)}get gamepad(){return this.gamepadManager}get keyboard(){return this.keyboardManager}firstGamepad(){return this.gamepadManager.first()}getActiveInputMethod(){const e=this.gamepadManager.first()!==null,s=this.keyboardManager.getStick("LEFT").magnitude>0||this.keyboardManager.getStick("RIGHT").magnitude>0||Object.values(this.keyboardManager.getKeyMappings()).some(n=>this.keyboardManager.isDown(n));return e&&s?"both":e?"gamepad":s?"keyboard":"none"}}document.getElementById("windows-shell");document.getElementById("lock-screen");const Ce=document.getElementById("switcher"),oe=document.getElementById("clock"),Me=document.getElementById("clock2"),Re=document.getElementById("auth");document.getElementById("progress-ring");const V=document.getElementById("progress-circle"),ze=document.getElementById("green"),Je=document.getElementById("blue"),Qe=document.getElementById("orange");let O=[ze,Je,Qe],k=["green","blue","orange"];function Ue(){return k.filter(t=>{const e=document.getElementById(t);return e&&!e.classList.contains("hidden-app")})}const d=new We;let qe=0;window.addEventListener("keydown",t=>{if((t.key.toLowerCase()==="s"||t.key.toLowerCase()==="l")&&M===w.SHELL&&ye){const e=Date.now();e-qe>lt&&(fe(ye),qe=e)}});const w={LOCKED:"locked",SHELL:"shell",MENU:"menu",APP:"app"};let M=w.LOCKED,m=0,a=0,S=!1,Pe=0,le=!1,o="preview",x=0,ue={area:"preview",navIndex:0,appIndex:0},ye=null;const ae=["library","settings","gallery","notifications"];let Se=!1,Oe=!1,I=0,h=-1;const Ze=3,pe=[6,8,7];let $=0;const et=11;let B=0;const tt=4;let y=0;const ke=4;let v=0,b=0,T=0,D=0;const N=2;let E=0;const st=9;let ge=[50,50,50],he=["Value 1","Value 2","Value 3"],se=[0,0,0,0,0,0],Ee=0,ne=!1,Te=0,ie=!1,me=0;const R=300,nt=300,it=300,ot=700,Ie=700,lt=200,u=.6,at=.3;window.addEventListener("keydown",t=>{t.key.toLowerCase()==="f"&&Be()});function Be(){document.fullscreenElement?document.exitFullscreen().catch(console.error):document.documentElement.requestFullscreen().catch(console.error)}const ct={"lock-screen":{controller:[{button:"A",action:"Unlock"}],keyboard:[{button:"A",action:"Unlock"}]},preview:{controller:[{button:"A",action:"Select"},{button:"â†’",action:"Nav Right"},{button:"â†",action:"Nav Left"},{button:"â†“",action:"Nav Down"},{button:"â†‘",action:"Nav Up"}],keyboard:[{button:"A",action:"Select"},{button:"â†’",action:"Nav Right"},{button:"â†",action:"Nav Left"},{button:"â†“",action:"Nav Down"},{button:"â†‘",action:"Nav Up"}]},"preview-scaled":{controller:[{button:"X",action:"Overlay"},{button:"X",action:"Hold for App Switching"}],keyboard:[{button:"D",action:"Overlay"},{button:"D",action:"Hold for App Switching"}]},"shell-nav":{controller:[{button:"A",action:"Select"},{button:"â†’",action:"Nav Right"},{button:"â†",action:"Nav Left"},{button:"â†“",action:"Nav Down"},{button:"â†‘",action:"Nav Up"}],keyboard:[{button:"A",action:"Select"},{button:"â†’",action:"Nav Right"},{button:"â†",action:"Nav Left"},{button:"â†“",action:"Nav Down"},{button:"â†‘",action:"Nav Up"}]},library:{controller:[{button:"A",action:"Select"},{button:"B",action:"Back"}],keyboard:[{button:"A",action:"Select"},{button:"S",action:"Back"}]},gallery:{controller:[{button:"A",action:"Select"},{button:"B",action:"Back"}],keyboard:[{button:"A",action:"Select"},{button:"S",action:"Back"}]},notifications:{controller:[{button:"A",action:"Select"},{button:"B",action:"Back"}],keyboard:[{button:"A",action:"Select"},{button:"S",action:"Back"}]},settings:{controller:[{button:"R",action:"Adjust (Right Stick)"},{button:"B",action:"Back"}],keyboard:[{button:"S",action:"Back"}]}};function A(t){const e=ct[t];if(!e)return;const s=document.querySelector(".controller-items"),n=document.querySelector(".keyboard-items");s&&(s.innerHTML=e.controller.map(i=>`
      <div class="legend-item">
        <div class="legend-button">${i.button}</div>
        <span class="legend-action">${i.action}</span>
      </div>
    `).join("")),n&&(n.innerHTML=e.keyboard.map(i=>`
      <div class="legend-item">
        <div class="legend-button">${i.button}</div>
        <span class="legend-action">${i.action}</span>
      </div>
    `).join(""))}function _e(){d.update(),rt(),ht(),requestAnimationFrame(_e)}function rt(){switch(M){case w.LOCKED:ft();break;case w.SHELL:Tt(),ut();break;case w.MENU:Bt();break;case w.APP:Dt();break;default:console.warn("Unknown UI state:",M);break}d.justPressed("VIEW")&&Be(),d.justPressed("MENU")&&M===w.LOCKED&&Be()}function ft(){if(M!==w.LOCKED)return;const t=d.isDown("A");if(t&&!ne)ne=!0,Te=Date.now(),V&&(V.style.transition="none",V.style.strokeDashoffset="100.53");else if(t&&ne){const e=Date.now()-Te,s=Math.min(e/ot,1);if(V){const i=100.53*(1-s);V.style.strokeDashoffset=i.toString()}s>=1&&dt()}else!t&&ne&&Fe()}function dt(){console.log("Hold complete! Authentication action triggered."),S=!1;const t=document.getElementById("lock-video");t&&t.pause(),ce(w.SHELL),re(),m=0,o="preview";const e=document.getElementById("focus"),s=document.getElementById("green-preview");if(s){s.classList.add("preview-scaled"),S=!0,A("preview-scaled");const i=document.getElementById("silksong-video");i&&(i.muted=!1,i.play().catch(l=>{}))}e&&(e.classList.add("visible"),C()),Re&&Re.classList.add("slide-out");const n=document.getElementById("quick-resume");n&&n.classList.add("dismiss"),Fe(),p.confirmation(),console.log("Lock screen unlocked! Shell interactions now active.")}function Fe(){M===w.LOCKED&&(ne=!1,Te=0,V&&(V.style.transition="stroke-dashoffset 0.2s ease",V.style.strokeDashoffset="100.53"))}function ut(){if(M!==w.SHELL||!S||o!=="preview")return;const t=d.isDown("X");t&&!ie?(ie=!0,me=Date.now(),console.log("X button hold started - will scale down preview in",Ie+"ms")):t&&ie?Date.now()-me>=Ie&&pt():!t&&ie&&(Date.now()-me<Ie&&(console.log("X button quick tap detected - toggling overlay"),gt()),Ve())}function pt(){console.log("X button hold complete! Scaling down preview and reordering to leftmost position.");const e=k.map(s=>document.getElementById(`${s}-preview`))[m];if(e&&e.classList.contains("preview-scaled")){e.classList.remove("preview-scaled"),S=!1,A("preview");const s=document.getElementById("silksong-video");if(s&&e.id==="green-preview"&&(s.muted=!0,s.pause()),le){const l=document.getElementById("overlay");l&&(l.classList.remove("visible"),le=!1,console.log("Overlay closed (preview scaled down)"))}const n=document.getElementById("running-apps");n&&n.classList.add("visible");const i=document.getElementById("shell-nav");if(i&&i.classList.add("visible"),m!==0){const l=O[m],c=k[m];O.splice(m,1),k.splice(m,1),O.unshift(l),k.unshift(c);const f=document.getElementById("running-apps");f&&(f.innerHTML="",O.forEach(r=>{r&&f.appendChild(r)})),m=0}Ne(),re(),C(),p.confirmation()}Ve()}function Ve(){ie=!1,me=0}function gt(){if(!S||o!=="preview"){console.log("Overlay can only be toggled when an app preview is fullscreen");return}const t=document.getElementById("overlay");if(t)if(le=!le,le){const e=k[m];t.classList.add("visible"),t.classList.remove("show-gb","show-steam"),e==="green"||e==="blue"?(t.classList.add("show-gb"),console.log(`Overlay opened: GB interface for ${e} app`)):e==="orange"&&(t.classList.add("show-steam"),console.log(`Overlay opened: Steam interface for ${e} app`)),p.lightTap()}else t.classList.remove("visible","show-gb","show-steam"),console.log("Overlay closed"),p.lightTap()}function ht(){mt(),$e()}function $e(){const t=M!==w.LOCKED;Ce&&(Ce.className=t?"unlocked":"locked"),oe&&(t?oe.classList.add("slide-out"):oe.classList.remove("slide-out"))}function mt(){const t=new Date;let e=t.getHours();const s=t.getMinutes();e===0?e=12:e>12&&(e=e-12);const n=`${e}:${s.toString().padStart(2,"0")}`;oe&&(oe.textContent=n),Me&&(Me.textContent=n)}async function Y(t=1,e=200){const s=d.firstGamepad();if(!s)return;const n=s.vibrationActuator;if(n)try{await n.playEffect("dual-rumble",{duration:e,strongMagnitude:t,weakMagnitude:t})}catch(i){console.warn("Rumble not supported:",i)}}const p={lightTap:()=>Y(.2,50),confirmation:()=>Y(.8,200),navigation:()=>Y(.1,30),error:()=>Y(.6,100),menuToggle:()=>Y(.4,150),selectionChange:()=>Y(.15,25)};function ce(t){M=t,t===w.LOCKED?A("lock-screen"):t===w.SHELL&&A("preview");const e=document.getElementById("blur-container");e&&(t!==w.LOCKED?e.classList.add("visible"):e.classList.remove("visible")),$e(),re()}function W(t){const e=Ue();if(e.length===0)return;const s=k[m],n=e.indexOf(s);let i;t==="right"?i=(n+1)%e.length:t==="left"&&(i=(n-1+e.length)%e.length);const l=e[i];m=k.indexOf(l),re(),p.selectionChange()}function z(t){t==="right"?x=(x+1)%ae.length:t==="left"&&(x=(x-1+ae.length)%ae.length),C(),p.selectionChange()}function re(){M===w.SHELL&&(O.forEach((t,e)=>{t&&(e===m?(t.classList.add("app-active"),t.classList.remove("app-rest")):(t.classList.add("app-rest"),t.classList.remove("app-active")))}),Ne())}function Ne(){const t=Ue(),e=t.map(l=>document.getElementById(`${l}-preview`));k.forEach(l=>{const c=document.getElementById(`${l}-preview`);c&&c.classList.remove("preview-center","preview-left","preview-right","preview-far-left","preview-far-right","preview-scaled")}),S=!1,A("preview");const s=t.length,n=k[m],i=t.indexOf(n);if(s===2)switch(i){case 0:e[0]?.classList.add("preview-center"),e[1]?.classList.add("preview-right");break;case 1:e[0]?.classList.add("preview-left"),e[1]?.classList.add("preview-center");break}else if(s===3)switch(i){case 0:e[0]?.classList.add("preview-center"),e[1]?.classList.add("preview-right"),e[2]?.classList.add("preview-far-right");break;case 1:e[0]?.classList.add("preview-left"),e[1]?.classList.add("preview-center"),e[2]?.classList.add("preview-right");break;case 2:e[0]?.classList.add("preview-far-left"),e[1]?.classList.add("preview-left"),e[2]?.classList.add("preview-center");break}C()}function je(){const e=k.map(s=>document.getElementById(`${s}-preview`))[m];if(e)if(S)console.log("Preview already scaled up. Use VIEW button hold to scale down.");else{if(e.classList.add("preview-scaled"),S=!0,A("preview-scaled"),e.id==="green-preview"){const i=document.getElementById("silksong-video");i&&(i.muted=!1,i.play().catch(l=>{}))}const s=document.getElementById("running-apps");s&&s.classList.remove("visible");const n=document.getElementById("shell-nav");n&&n.classList.remove("visible"),C(),p.confirmation()}}function C(){const t=document.getElementById("focus");if(t)if(t.classList.remove("focus-preview","focus-nav","focus-shell-surface","focus-shell-library","focus-shell-settings"),o==="preview"){Ae();const s=k.map(i=>document.getElementById(`${i}-preview`))[m];if(!s)return;s.classList.contains("preview-scaled")?(t.style.width="1280px",t.style.height="720px"):(t.style.width="648px",t.style.height="432px"),t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.classList.add("focus-preview")}else if(o==="shell-nav"){t.classList.add("focus-nav");const e=document.getElementById(ae[x]);if(!e)return;const s=e.getBoundingClientRect(),n=document.getElementById("windows-shell").getBoundingClientRect();t.style.width="64px",t.style.height="64px",t.style.top=`${s.top-n.top+s.height/2}px`,t.style.left=`${s.left-n.left+s.width/2}px`,t.style.transform="translate(-50%, -50%)",Ae(ae[x])}else o==="shell-surface"&&Ae()}function Ae(t=null){const e={library:document.getElementById("label-library"),settings:document.getElementById("label-settings"),notifications:document.getElementById("label-notifications"),gallery:document.getElementById("label-gallery")},s=document.getElementById("shell-nav");if(!t||!s){Object.values(e).forEach(g=>{g&&g.classList.remove("active","faded")});return}const n=document.getElementById(t);if(!n)return;const i=n.getBoundingClientRect(),l=s.getBoundingClientRect(),c=i.top-l.top,f=i.left-l.left,r=i.width;Object.entries(e).forEach(([g,L])=>{if(L)if(g===t){L.classList.add("active"),L.classList.remove("faded");const be=c-16-20,G=f+r/2;L.style.top=`${be}px`,L.style.left=`${G}px`,L.style.transform="translateX(-50%)"}else L.classList.remove("active"),L.classList.add("faded")})}function yt(){o=ue.area,m=ue.appIndex,x=ue.navIndex;const t=document.getElementById("focus"),e=document.getElementById("shell-nav");t&&(t.style.opacity="1"),e&&(e.style.opacity="1"),C()}function X(){const t=document.getElementById("focus"),e=document.querySelector(".library-search-box"),s=document.querySelectorAll(".launcher-row-container"),n=document.querySelector(".library-content");if(!t)return;if(t.style.opacity="0",document.querySelectorAll(".launcher-app").forEach(l=>l.classList.remove("focused")),e&&e.classList.remove("focused"),h===-1){e&&e.classList.add("focused"),s.forEach(l=>{l.style.transition="transform 0.3s ease",l.style.transform="translateY(0)"});return}const i=s[h];if(i){const f=i.querySelector(".launchers").querySelectorAll(".launcher-app")[I];f&&f.classList.add("focused");const r=pe[h];if(r>5){let L=0;if(I>=3){L=-(I-2)*194;const G=-(r-5)*194;L=Math.max(L,G)}i.style.transition="transform 0.3s ease",i.style.transform=`translateX(${L}px) translateY(${h>=2?-264*(h-1):0}px)`}else i.style.transition="transform 0.3s ease",i.style.transform=`translateX(0) translateY(${h>=2?-264*(h-1):0}px)`}if(n){let l=0;h>=2&&(l=-264*(h-1)),s.forEach((c,f)=>{f!==h&&(c.style.transition="transform 0.3s ease",c.style.transform=`translateY(${l}px)`)}),e&&(e.style.transition="transform 0.3s ease",e.style.transform=`translateX(-50%) translateY(${l}px)`)}}function j(t){if(h===-1){t==="down"&&(h=0,I=0,X());return}const e=pe[h];t==="left"&&I>0?(I--,X()):t==="right"&&I<e-1?(I++,X()):t==="up"?h>0?(h--,I=Math.min(I,pe[h]-1),X()):h===0&&(h=-1,I=0,X()):t==="down"&&h<Ze-1&&(h++,I=Math.min(I,pe[h]-1),X())}function De(){const t=document.querySelectorAll(".nav-page-item");if(!(!t||t.length===0)&&(t.forEach(e=>e.classList.remove("focused")),t[$])){t[$].classList.add("focused");const e=document.querySelector(".settings-nav-pages");if(e)if($>=2){const s=t[2];if(s){const n=s.offsetTop;e.scrollTo({top:n,behavior:"smooth"})}}else e.scrollTo({top:0,behavior:"smooth"})}}function H(t){t==="up"&&$>0?($--,De()):t==="down"&&$<et-1?($++,De()):t==="right"&&(document.querySelectorAll(".nav-page-item").forEach(s=>s.classList.remove("focused")),o="settings-display-controls",E=0,ve())}function ve(){const t=document.querySelectorAll(".section-settings"),e=[];if(t.forEach(s=>{const n=s.querySelector(".slider-control"),i=s.querySelectorAll(".cycle-selector");n&&e.push(n),i.forEach(l=>e.push(l))}),!(!e||e.length===0)&&(e.forEach(s=>{s&&s.classList.remove("focused")}),e[E])){e[E].classList.add("focused");const s=document.querySelector(".settings-content-container");if(E<=2)s&&s.scrollTo({top:0,behavior:"smooth"});else if(E>=6){const n=t[2];if(n&&s){const i=n.offsetTop;s.scrollTo({top:i,behavior:"smooth"})}}}}function U(t){if(t==="up"&&E>0)E--,ve();else if(t==="down"&&E<st-1)E++,ve();else if(t==="left"){const e=document.querySelectorAll(".section-settings"),s=[];e.forEach(n=>{const i=n.querySelector(".slider-control"),l=n.querySelectorAll(".cycle-selector");i&&s.push(i),l.forEach(c=>s.push(c))}),s.forEach(n=>{n&&n.classList.remove("focused")}),o="settings-nav",De()}}function Xe(t){const e=t===0?0:t===3?1:2,n=document.querySelectorAll(".section-settings")[e];if(!n)return;const i=n.querySelector(".slider-knob"),l=n.querySelector(".slider-value"),c=ge[e];i&&(i.style.left=`${c}%`),l&&(l.style.width=`${c}%`)}function xe(t){const s={1:0,2:1,4:2,5:3,7:4,8:5}[t];if(s===void 0)return;const n=document.querySelectorAll(".section-settings"),i=[];n.forEach(f=>{f.querySelectorAll(".cycle-selector").forEach(g=>i.push(g))});const l=i[s];if(!l)return;const c=l.querySelector(".cycle-value");c&&(c.textContent=he[se[s]])}function we(){const t=document.querySelectorAll(".gallery-nav-pages .nav-page-item");!t||t.length===0||(t.forEach(e=>e.classList.remove("focused")),t[B]&&t[B].classList.add("focused"))}function _(t){t==="up"&&B>0?(B--,we()):t==="down"&&B<tt-1?(B++,we()):t==="right"&&(document.querySelectorAll(".gallery-nav-pages .nav-page-item").forEach(s=>s.classList.remove("focused")),o="gallery-media",T=0,D=0,Q())}function vt(){const t=document.querySelectorAll(".gallery-nav-pages .nav-page-item"),e=document.querySelectorAll(".gallery-media-item"),s=document.querySelector(".gallery-header h1");if(!t||t.length===0)return;t.forEach(l=>l.classList.remove("selected")),t.forEach(l=>l.classList.remove("focused")),t[B]&&t[B].classList.add("selected");let n="all",i="All content";B===1?(n="image",i="Photos"):B===2?(n="video",i="Videos"):B===3&&(n="file",i="Files"),s&&(s.textContent=i),e.forEach(l=>{l.classList.add("fade-out")}),setTimeout(()=>{e.forEach(l=>{const c=l.getAttribute("data-type");n==="all"||c===n?(l.style.display="",l.classList.remove("fade-out"),l.classList.add("fade-in")):(l.style.display="none",l.classList.remove("fade-out"))}),e.forEach(l=>l.classList.remove("focused")),we()},300)}function Q(){const t=document.querySelectorAll(".gallery-media-item"),e=Array.from(t).filter(n=>n.style.display!=="none");if(!e||e.length===0)return;t.forEach(n=>n.classList.remove("focused"));const s=T*N+D;if(e[s]){e[s].classList.add("focused");const n=document.querySelector(".gallery-media-grid");if(n)if(T>=3){const i=Math.min(T,Math.floor((e.length-1)/N)),l=e.filter((c,f)=>Math.floor(f/N)===i);if(l.length>0){const c=l[0].offsetTop;n.scrollTo({top:c-50,behavior:"smooth"})}}else if(T>=2){const i=e.filter((l,c)=>Math.floor(c/N)===2);if(i.length>0){const l=i[0].offsetTop;n.scrollTo({top:l-100,behavior:"smooth"})}}else n.scrollTo({top:0,behavior:"smooth"})}}function F(t){const e=document.querySelectorAll(".gallery-media-item"),s=Array.from(e).filter(c=>c.style.display!=="none");if(s.length===0)return;const n=s.length,i=Math.floor((n-1)/N),l=Math.min(N,n-T*N);if(t==="left")D>0?(D--,Q()):(o="gallery-nav",we(),e.forEach(c=>c.classList.remove("focused")));else if(t==="right"&&D<l-1)D++,Q();else if(t==="up"&&T>0){T--;const c=Math.min(N,n-T*N);D>=c&&(D=c-1),Q()}else if(t==="down"&&T<i){T++;const c=Math.min(N,n-T*N);D>=c&&(D=c-1),Q()}}function q(){const t=document.querySelectorAll("#shell-notifications .nav-page-item"),e=document.querySelectorAll("#shell-notifications .notification"),s=document.querySelectorAll(".notification-action-button");!t||t.length===0||(t.forEach(n=>n.classList.remove("focused")),e.forEach(n=>n.classList.remove("focused")),s.forEach(n=>n.classList.remove("focused")),t[y]&&t[y].classList.add("focused"))}function ee(t){t==="up"&&y>0?(y--,q()):t==="down"&&y<ke-1&&(y++,q())}function wt(){const t=document.querySelectorAll("#shell-notifications .nav-page-item"),e=document.querySelectorAll("#shell-notifications .notification"),s=document.querySelector(".notifications-header h1"),n=document.querySelectorAll(".notification-action-button"),i=n[0],l=n[1];if(!t||t.length===0)return;t.forEach(r=>r.classList.remove("selected")),t.forEach(r=>r.classList.remove("focused")),t[y]&&t[y].classList.add("selected");let c="all",f="All notifications";y===1?(c="urgent",f="Urgent"):y===2?(c="social",f="Social"):y===3&&(c="update",f="Updates"),s&&(s.textContent=f),i&&l&&(y===1?(i.style.display="none",l.style.display=""):y===2?(i.style.display="",l.style.display="none"):y===3?(i.style.display="none",l.style.display=""):(i.style.display="",l.style.display="")),e.forEach(r=>{r.classList.add("fade-out")}),setTimeout(()=>{e.forEach(r=>{const g=r.getAttribute("data-type");c==="all"?(r.style.display="",r.classList.remove("fade-out"),r.classList.add("fade-in")):c==="update"?g&&(g.includes("game-update")||g.includes("app-update")||g.includes("system-update"))?(r.style.display="",r.classList.remove("fade-out"),r.classList.add("fade-in")):(r.style.display="none",r.classList.remove("fade-out")):g&&g.includes(c)?(r.style.display="",r.classList.remove("fade-out"),r.classList.add("fade-in")):(r.style.display="none",r.classList.remove("fade-out"))}),e.forEach(r=>r.classList.remove("focused")),q()},300)}function P(){const t=document.querySelectorAll("#shell-notifications .notification"),e=Array.from(t).filter(l=>l.style.display!=="none"),s=document.querySelectorAll("#shell-notifications .nav-page-item"),n=document.querySelectorAll(".notification-action-button"),i=document.querySelector("#shell-notifications .notifications-list");if(!(!e||e.length===0))if(t.forEach(l=>l.classList.remove("focused")),s.forEach(l=>l.classList.remove("focused")),n.forEach(l=>l.classList.remove("focused")),e[v]&&e[v].classList.add("focused"),i&&v>=4&&e.length>4){const l=e[4];if(l){const c=l.offsetTop;console.log(`Scrolling to notification ${v+1}, offsetTop: ${c}, scrollTo: ${c-72}`),i.scrollTo({top:c-72,behavior:"smooth"})}}else i&&v<=3&&(console.log(`Resetting scroll to top for notification ${v+1}`),i.scrollTo({top:0,behavior:"smooth"}))}function te(t){const e=document.querySelectorAll("#shell-notifications .notification"),s=Array.from(e).filter(i=>i.style.display!=="none");if(s.length===0)return;const n=s.length-1;t==="up"&&v>0?(v--,P()):t==="down"&&v<n&&(v++,P())}function Z(){const t=document.querySelectorAll(".notification-action-button"),e=document.querySelectorAll("#shell-notifications .nav-page-item"),s=document.querySelectorAll("#shell-notifications .notification");!t||t.length===0||(t.forEach(n=>n.classList.remove("focused")),e.forEach(n=>n.classList.remove("focused")),s.forEach(n=>n.classList.remove("focused")),t[b]&&t[b].classList.add("focused"))}function J(t){const e=document.querySelectorAll(".notification-action-button");!e||e.length===0||(t==="left"&&b>0?(b--,Z()):t==="right"&&b<e.length-1&&(b++,Z()))}function Le(t){ue={area:o,navIndex:x,appIndex:m};const e=document.getElementById(`shell-${t}`),s=document.getElementById("focus"),n=document.getElementById("running-apps");if(!e)return;e.classList.add("visible"),n&&n.classList.remove("visible"),document.querySelectorAll(".preview-container").forEach(c=>{c.classList.add("hide-right")}),o="shell-surface",ye=t;const l=document.getElementById("shell-nav");if(s&&(s.style.opacity="0"),l&&(l.style.opacity="0"),t==="library"&&(o="library-launchers",I=0,h=-1,X(),A("library")),t==="settings"){o="settings-display-controls",E=0,ve(),A("settings");for(let r=0;r<3;r++)Xe(r*3);[1,2,4,5,7,8].forEach(r=>{xe(r)});const f=document.querySelectorAll(".settings-nav-pages .nav-page-item");f[0]&&f[0].classList.add("selected")}if(t==="gallery"){B=0;const c=document.querySelectorAll(".gallery-nav-pages .nav-page-item");c.forEach(g=>g.classList.remove("selected")),c[0]&&c[0].classList.add("selected"),document.querySelectorAll(".gallery-media-item").forEach(g=>{g.style.display="",g.classList.remove("fade-out","fade-in")});const r=document.querySelector(".gallery-header h1");r&&(r.textContent="All content"),o="gallery-media",T=0,D=0,Q(),A("gallery")}if(t==="notifications"){y=0;const c=document.querySelectorAll("#shell-notifications .nav-page-item");c.forEach(g=>g.classList.remove("selected")),c[0]&&c[0].classList.add("selected"),document.querySelectorAll("#shell-notifications .notification").forEach(g=>{g.style.display="",g.classList.remove("fade-out","fade-in")});const r=document.querySelector(".notifications-header h1");r&&(r.textContent="All notifications"),o="notifications-content",v=0,P(),A("notifications")}}function fe(t){const e=document.getElementById(`shell-${t}`);document.getElementById("focus");const s=document.getElementById("running-apps");if(!e)return;e.classList.remove("visible"),s&&s.classList.add("visible"),document.querySelectorAll(".preview-container").forEach(i=>{i.classList.remove("hide-right")}),ye=null,o==="library-launchers"&&(I=0,h=0,document.querySelectorAll(".launcher-app").forEach(i=>{i.classList.remove("focused")}),document.querySelectorAll(".launchers").forEach(i=>{i.style.transform="translateX(0) translateY(0)"})),(o==="settings-nav"||o==="settings-display-controls")&&($=0,E=0,document.querySelectorAll(".nav-page-item").forEach(i=>{i.classList.remove("focused"),i.classList.remove("selected")}),document.querySelectorAll(".slider-control, .cycle-selector").forEach(i=>{i.classList.remove("focused")})),(o==="gallery-nav"||o==="gallery-media")&&(B=0,T=0,D=0,document.querySelectorAll(".gallery-nav-pages .nav-page-item").forEach(i=>{i.classList.remove("focused"),i.classList.remove("selected")}),document.querySelectorAll(".gallery-media-item").forEach(i=>{i.classList.remove("focused")})),(o==="notifications-nav"||o==="notifications-buttons"||o==="notifications-content")&&(y=0,v=0,b=0,document.querySelectorAll("#shell-notifications .nav-page-item").forEach(i=>{i.classList.remove("focused"),i.classList.remove("selected")}),document.querySelectorAll(".notification-action-button").forEach(i=>{i.classList.remove("focused")}),document.querySelectorAll("#shell-notifications .notification").forEach(i=>{i.classList.remove("focused")})),yt(),A("preview")}function Lt(){Le("library")}function He(){fe("library")}function bt(){Le("settings")}function St(){fe("settings")}function Et(){Le("notifications")}function It(){fe("notifications")}function At(){Le("gallery")}function kt(){fe("gallery")}function Tt(){const t=Date.now();if((d.justPressed("LEFT")||d.isDown("LEFT")&&t-a>R)&&(o==="library-launchers"?(j("left"),a=t):o==="settings-nav"?(H("left"),a=t):o==="gallery-nav"?(_("left"),a=t):o==="gallery-media"?(F("left"),a=t):o==="settings-display-controls"?(U("left"),a=t):o==="notifications-content"?(o="notifications-nav",q(),a=t):o==="notifications-buttons"?b>0?(J("left"),a=t):(o="notifications-nav",q(),a=t):o!=="shell-surface"&&(o==="preview"&&!S?W("left"):o==="shell-nav"&&z("left"),a=t)),d.justPressed("RIGHT")||d.isDown("RIGHT")&&t-a>R)if(o==="library-launchers")j("right"),a=t;else if(o==="settings-nav")H("right"),a=t;else if(o==="gallery-nav")_("right"),a=t;else if(o==="gallery-media")F("right"),a=t;else if(o==="settings-display-controls")U("right"),a=t;else if(o==="notifications-nav")o="notifications-content",v=0,P(),a=t;else if(o==="notifications-buttons"){const l=document.querySelectorAll(".notification-action-button");b<l.length-1?(J("right"),a=t):(o="notifications-content",v=0,P(),a=t)}else o!=="shell-surface"&&(o==="preview"&&!S?W("right"):o==="shell-nav"&&z("right"),a=t);(d.justPressed("LB")||d.isDown("LB")&&t-a>R)&&o!=="shell-surface"&&(o==="preview"&&!S?W("left"):o==="shell-nav"&&z("left"),a=t),(d.justPressed("RB")||d.isDown("RB")&&t-a>R)&&o!=="shell-surface"&&(o==="preview"&&!S?W("right"):o==="shell-nav"&&z("right"),a=t);const e=d.getStick("LEFT"),s=Date.now();if(e.magnitude>u&&s-a>R)if(o==="library-launchers")e.x>u?(j("right"),a=s):e.x<-u&&(j("left"),a=s);else if(o==="settings-nav")e.x>u&&(H("right"),a=s);else if(o==="gallery-nav")e.x>u&&(_("right"),a=s);else if(o==="gallery-media")e.x>u?(F("right"),a=s):e.x<-u&&(F("left"),a=s);else if(o==="settings-display-controls")e.x<-u&&(U("left"),a=s);else if(o==="notifications-nav")e.x>u&&(o="notifications-content",v=0,P(),a=s);else if(o==="notifications-buttons"){const l=document.querySelectorAll(".notification-action-button");e.x>u?b<l.length-1?(J("right"),a=s):(o="notifications-content",v=0,P(),a=s):e.x<-u&&(b>0?(J("left"),a=s):(o="notifications-nav",q(),a=s))}else o==="notifications-content"?e.x<-u&&(o="notifications-nav",q(),a=s):o!=="shell-surface"&&(e.x>u?(o==="preview"&&!S?W("right"):o==="shell-nav"&&z("right"),a=s):e.x<-u&&(o==="preview"&&!S?W("left"):o==="shell-nav"&&z("left"),a=s));if(e.magnitude>u&&s-a>R)if(o==="library-launchers")e.y>u?(j("up"),a=s):e.y<-u&&(j("down"),a=s);else if(o==="settings-nav")e.y>u?(H("up"),a=s):e.y<-u&&(H("down"),a=s);else if(o==="gallery-nav")e.y>u?(_("up"),a=s):e.y<-u&&(_("down"),a=s);else if(o==="notifications-nav")e.y>u?(ee("up"),a=s):e.y<-u&&(y===ke-1?(o="notifications-buttons",y===2?b=0:b=1,Z(),a=s):(ee("down"),a=s));else if(o==="notifications-buttons"){const l=document.querySelectorAll(".notification-action-button");e.x>u?b<l.length-1&&(J("right"),a=s):e.x<-u?b>0&&(J("left"),a=s):e.y>u?(o="notifications-nav",q(),a=s):e.y<-u&&(o="notifications-content",v=0,P(),a=s)}else o==="notifications-content"?e.y>u?v===0?(o="notifications-buttons",b=1,Z(),a=s):(te("up"),a=s):e.y<-u&&(te("down"),a=s):o==="gallery-media"?e.y>u?(F("up"),a=s):e.y<-u&&(F("down"),a=s):o==="settings-display-controls"?e.y>u?(U("up"),a=s):e.y<-u&&(U("down"),a=s):o!=="shell-surface"&&(e.y>u?o==="shell-nav"&&!S&&(o="preview",C(),A("preview"),a=s):e.y<-u&&o==="preview"&&!S&&(o="shell-nav",C(),A("shell-nav"),a=s));(d.justPressed("DOWN")||d.isDown("DOWN")&&t-a>R)&&(o==="library-launchers"?(j("down"),a=t):o==="settings-nav"?(H("down"),a=t):o==="gallery-nav"?(_("down"),a=t):o==="notifications-nav"?y===ke-1?(o="notifications-buttons",y===2?b=0:b=1,Z(),a=t):(ee("down"),a=t):o==="notifications-buttons"?(o="notifications-content",v=0,P(),a=t):o==="notifications-content"?(te("down"),a=t):o==="gallery-media"?(F("down"),a=t):o==="settings-display-controls"?(U("down"),a=t):o!=="shell-surface"&&o==="preview"&&!S&&(o="shell-nav",C(),A("shell-nav"),a=t)),(d.justPressed("UP")||d.isDown("UP")&&t-a>R)&&(o==="library-launchers"?(j("up"),a=t):o==="settings-nav"?(H("up"),a=t):o==="gallery-nav"?(_("up"),a=t):o==="notifications-nav"?(ee("up"),a=t):o==="notifications-buttons"?(o="notifications-nav",q(),a=t):o==="notifications-content"?v===0?(o="notifications-buttons",b=1,Z(),a=t):(te("up"),a=t):o==="gallery-media"?(F("up"),a=t):o==="settings-display-controls"?(U("up"),a=t):o!=="shell-surface"&&o==="shell-nav"&&!S&&(o="preview",C(),A("preview"),a=t)),(d.justPressed("DOWN")||d.isDown("DOWN")&&t-a>R)&&(o==="settings-nav"?(H("down"),a=t):o==="gallery-nav"?(_("down"),a=t):o==="notifications-nav"?(ee("down"),a=t):o==="notifications-content"?(te("down"),a=t):o==="settings-display-controls"&&(U("down"),a=t)),S&&o==="preview"&&(d.getStick("LEFT").magnitude>u,d.justPressed("UP"),d.justPressed("DOWN"),d.justPressed("LEFT"),d.justPressed("RIGHT"));const n=Date.now();if(d.isDown("A")&&n-Pe>nt){if(Se)return;if(Pe=n,o==="library-launchers")if(h===0&&I===1){if(Oe){p.lightTap();return}Se=!0,Oe=!0,He(),setTimeout(()=>{const l=document.getElementById("orange"),c=document.getElementById("orange-preview");l&&l.classList.remove("hidden-app"),c&&(c.classList.remove("hidden-app"),c.classList.add("slide-in-left")),m=2;const f=O[m],r=k[m];O.splice(m,1),k.splice(m,1),O.unshift(f),k.unshift(r);const g=document.getElementById("running-apps");g&&(g.innerHTML="",O.forEach(L=>{L&&g.appendChild(L)})),m=0,re(),Ne(),setTimeout(()=>{c&&c.classList.remove("slide-in-left"),o="preview",C(),setTimeout(()=>{je(),setTimeout(()=>{Se=!1},400)},400)},600)},100),p.confirmation()}else p.confirmation();else o==="preview"?je():o==="shell-nav"?x===0?(Lt(),p.confirmation()):x===1?(bt(),p.confirmation()):x===2?(At(),p.confirmation()):x===3&&(Et(),p.confirmation()):o==="gallery-nav"?(vt(),p.confirmation()):o==="notifications-nav"?(wt(),p.confirmation()):o==="shell-surface"&&p.lightTap()}if(d.justPressed("B")){const l=document.getElementById("shell-library"),c=document.getElementById("shell-settings"),f=document.getElementById("shell-notifications"),r=document.getElementById("shell-gallery");l&&l.classList.contains("visible")?(He(),p.lightTap()):c&&c.classList.contains("visible")?(St(),p.lightTap()):f&&f.classList.contains("visible")?(It(),p.lightTap()):(r&&r.classList.contains("visible")&&kt(),p.lightTap())}d.justPressed("Y")&&p.lightTap(),d.justPressed("LT")&&p.menuToggle(),d.justPressed("RT")&&p.menuToggle();const i=d.getStick("RIGHT");if(o==="settings-display-controls"&&[0,3,6].includes(E)){if(i.magnitude>at){const l=E===0?0:E===3?1:2,c=2;ge[l]+=i.x*c,ge[l]=Math.max(0,Math.min(100,ge[l])),Xe(E)}}else if(o==="settings-display-controls"&&[1,2,4,5,7,8].includes(E)){const l=Date.now();if(i.magnitude>u&&l-Ee>it){const f={1:0,2:1,4:2,5:3,7:4,8:5}[E];i.x>u?(se[f]=(se[f]+1)%he.length,xe(E),Ee=l):i.x<-u&&(se[f]=(se[f]-1+he.length)%he.length,xe(E),Ee=l)}}d.justPressed("LS")&&p.lightTap(),d.justPressed("RS")&&p.lightTap(),d.justPressed("MENU")&&(console.log("Shell: Opening main menu"),ce(w.MENU),p.menuToggle())}function Bt(){console.log("Menu inputs active - navigating menu system!"),d.justPressed("UP")&&(console.log("Menu: Navigate up"),p.selectionChange()),d.justPressed("DOWN")&&(console.log("Menu: Navigate down"),p.selectionChange()),d.justPressed("A")&&(console.log("Menu: Select item"),p.confirmation()),d.justPressed("B")&&(console.log("Menu: Back to shell"),ce(w.SHELL),p.menuToggle()),d.justPressed("MENU")&&(console.log("Menu: Closing menu"),ce(w.SHELL),p.menuToggle())}function Dt(){console.log("App inputs active - app-specific controls!"),d.justPressed("B")&&(console.log("App: Back to shell"),ce(w.SHELL),p.lightTap())}A("lock-screen");requestAnimationFrame(_e);
