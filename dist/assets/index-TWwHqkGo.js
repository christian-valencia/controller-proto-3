(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(n){if(n.ep)return;n.ep=!0;const l=s(n);fetch(n.href,l)}})();const oe={LS_X:0,LS_Y:1,RS_X:2,RS_Y:3},Fe={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,VIEW:8,MENU:9,LS:10,RS:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16};class Ue{prev=new Map;now=new Map;deadzone=.18;triggerThreshold=.2;indexOfFirst=null;constructor(){console.log("ðŸŽ® GamepadManager initialized"),window.addEventListener("gamepadconnected",e=>{console.log("ðŸŽ® GAMEPAD CONNECTED:",e.gamepad.id),this.indexOfFirst===null&&(this.indexOfFirst=e.gamepad.index)}),window.addEventListener("gamepaddisconnected",e=>{console.log("ðŸŽ® GAMEPAD DISCONNECTED:",e.gamepad.id);const s=e.gamepad.index;this.indexOfFirst===s&&(this.indexOfFirst=null)})}first(){const e=navigator.getGamepads();for(const s of e)if(s)return s;return null}update(){this.prev=new Map(this.now),this.now.clear();const e=navigator.getGamepads();for(const s of e)s&&this.now.set(s.index,s)}btnValue(e,s){const i=e.buttons[Fe[s]];return i?s==="LT"||s==="RT"?i.value>=this.triggerThreshold?i.value:0:i.pressed?1:0:0}isDown(e,s=0){let i=this.now.get(s);if(!i){for(const[n,l]of this.now.entries())if(l){i=l;break}}return i?this.btnValue(i,e)>0:!1}justPressed(e,s=0){let i=this.now.get(s),n=this.prev.get(s);if(!i){for(const[f,g]of this.now.entries())if(g){i=g,n=this.prev.get(f);break}}if(!i)return!1;const l=this.btnValue(i,e)>0,r=n?this.btnValue(n,e)>0:!1;return l&&!r}justReleased(e,s=0){let i=this.now.get(s),n=this.prev.get(s);if(!i){for(const[f,g]of this.now.entries())if(g){i=g,n=this.prev.get(f);break}}if(!i)return!1;const l=this.btnValue(i,e)>0,r=n?this.btnValue(n,e)>0:!1;return!l&&r}getStick(e,s=0){let i=this.now.get(s);if(!i){for(const[he,F]of this.now.entries())if(F){i=F;break}}if(!i)return{x:0,y:0,magnitude:0};const n=e==="LEFT"?oe.LS_X:oe.RS_X,l=e==="LEFT"?oe.LS_Y:oe.RS_Y;let r=i.axes[n]??0,f=i.axes[l]??0;f=-f;const g=Math.hypot(r,f);if(g<this.deadzone)return{x:0,y:0,magnitude:0};const S=(g-this.deadzone)/(1-this.deadzone),m=S/(g||1);return{x:r*m,y:f*m,magnitude:S}}}const U={a:"A",A:"A",s:"B",S:"B",d:"X",D:"X",w:"Y",W:"Y",j:"A",J:"A",l:"B",L:"B",i:"Y",I:"Y",k:"X",K:"X",ArrowUp:"UP",ArrowDown:"DOWN",ArrowLeft:"LEFT",ArrowRight:"RIGHT",q:"LB",Q:"LB",e:"RB",E:"RB",z:"LT",Z:"LT",c:"RT",C:"RT",v:"LS",V:"LS",n:"RS",N:"RS",Tab:"VIEW",Enter:"MENU",Escape:"HOME"};class Ve{keysDown=new Set;prevKeysDown=new Set;leftStick={x:0,y:0};rightStick={x:0,y:0};constructor(){window.addEventListener("keydown",e=>{(U[e.key]||e.key==="Tab")&&e.preventDefault(),this.keysDown.add(e.key),this.updateSticks()}),window.addEventListener("keyup",e=>{(U[e.key]||e.key==="Tab")&&e.preventDefault(),this.keysDown.delete(e.key),this.updateSticks()})}updateSticks(){let e=0,s=0;this.keysDown.has("Control")&&((this.keysDown.has("a")||this.keysDown.has("A"))&&(e-=1),(this.keysDown.has("d")||this.keysDown.has("D"))&&(e+=1),(this.keysDown.has("w")||this.keysDown.has("W"))&&(s+=1),(this.keysDown.has("s")||this.keysDown.has("S"))&&(s-=1));let n=0,l=0;this.keysDown.has("Alt")&&((this.keysDown.has("j")||this.keysDown.has("J"))&&(n-=1),(this.keysDown.has("l")||this.keysDown.has("L"))&&(n+=1),(this.keysDown.has("i")||this.keysDown.has("I"))&&(l+=1),(this.keysDown.has("k")||this.keysDown.has("K"))&&(l-=1)),this.leftStick={x:e,y:s},this.rightStick={x:n,y:l}}update(){this.prevKeysDown=new Set(this.keysDown)}isDown(e){for(const[s,i]of Object.entries(U))if(i===e&&this.keysDown.has(s))return!0;return!1}justPressed(e){if(!this.isDown(e))return!1;for(const[i,n]of Object.entries(U))if(n===e&&this.prevKeysDown.has(i))return!1;return!0}justReleased(e){if(this.isDown(e))return!1;for(const[i,n]of Object.entries(U))if(n===e&&this.prevKeysDown.has(i))return!0;return!1}getStick(e){const s=e==="LEFT"?this.leftStick:this.rightStick,i=Math.hypot(s.x,s.y);return i>1?{x:s.x/i,y:s.y/i,magnitude:1}:{x:s.x,y:s.y,magnitude:i}}getKeyMappings(){return{...U}}}class Ge{gamepadManager;keyboardManager;constructor(){this.gamepadManager=new Ue,this.keyboardManager=new Ve}update(){this.gamepadManager.update(),this.keyboardManager.update()}isDown(e,s=0){return this.gamepadManager.isDown(e,s)||this.keyboardManager.isDown(e)}justPressed(e,s=0){return this.gamepadManager.justPressed(e,s)||this.keyboardManager.justPressed(e)}justReleased(e,s=0){return this.gamepadManager.justReleased(e,s)||this.keyboardManager.justReleased(e)}getStick(e,s=0){const i=this.gamepadManager.getStick(e,s);return i.magnitude>.1?i:this.keyboardManager.getStick(e)}get gamepad(){return this.gamepadManager}get keyboard(){return this.keyboardManager}firstGamepad(){return this.gamepadManager.first()}getActiveInputMethod(){const e=this.gamepadManager.first()!==null,s=this.keyboardManager.getStick("LEFT").magnitude>0||this.keyboardManager.getStick("RIGHT").magnitude>0||Object.values(this.keyboardManager.getKeyMappings()).some(i=>this.keyboardManager.isDown(i));return e&&s?"both":e?"gamepad":s?"keyboard":"none"}}document.getElementById("windows-shell");document.getElementById("lock-screen");const Ae=document.getElementById("switcher"),Q=document.getElementById("clock"),De=document.getElementById("clock2"),Be=document.getElementById("auth");document.getElementById("progress-ring");const R=document.getElementById("progress-circle"),$e=document.getElementById("green"),Xe=document.getElementById("blue"),Ye=document.getElementById("orange");let D=[$e,Xe,Ye],E=["green","blue","orange"];function Oe(){return E.filter(t=>{const e=document.getElementById(t);return e&&!e.classList.contains("hidden-app")})}const c=new Ge;let xe=0;window.addEventListener("keydown",t=>{if((t.key.toLowerCase()==="s"||t.key.toLowerCase()==="l")&&T===w.SHELL&&de){const e=Date.now();e-xe>it&&(ie(de),xe=e)}});const w={LOCKED:"locked",SHELL:"shell",MENU:"menu",APP:"app"};let T=w.LOCKED,h=0,a=0,y=!1,Ce=0,Z=!1,o="preview",b=0,le={area:"preview",navIndex:0,appIndex:0},de=null;const ee=["library","settings","gallery","notifications"];let me=!1,Me=!1,L=0,p=-1;const Ke=3,ae=[5,8,6];let q=0;const We=11;let _=0;const ze=4;let B=0;const Je=5;let I=0;const Qe=8;let x=0,j=0;const Le=2,Ze=4;let v=0;const et=9;let re=[50,50,50],ce=["Value 1","Value 2","Value 3"],W=[0,0,0,0,0,0],ye=0,z=!1,Ee=0,J=!1,fe=0;const A=300,tt=300,st=300,nt=700,ve=700,it=200,d=.6,ot=.3;window.addEventListener("keydown",t=>{t.key.toLowerCase()==="f"&&Se()});function Se(){document.fullscreenElement?document.exitFullscreen().catch(console.error):document.documentElement.requestFullscreen().catch(console.error)}function Re(){c.update(),lt(),ut(),requestAnimationFrame(Re)}function lt(){switch(T){case w.LOCKED:at();break;case w.SHELL:St(),ct();break;case w.MENU:It();break;case w.APP:bt();break;default:console.warn("Unknown UI state:",T);break}c.justPressed("VIEW")&&Se(),c.justPressed("MENU")&&T===w.LOCKED&&Se()}function at(){if(T!==w.LOCKED)return;const t=c.isDown("Y");if(t&&!z)z=!0,Ee=Date.now(),R&&(R.style.transition="none",R.style.strokeDashoffset="100.53");else if(t&&z){const e=Date.now()-Ee,s=Math.min(e/nt,1);if(R){const n=100.53*(1-s);R.style.strokeDashoffset=n.toString()}s>=1&&rt()}else!t&&z&&qe()}function rt(){console.log("Hold complete! Authentication action triggered."),y=!1;const t=document.getElementById("lock-video");t&&t.pause(),te(w.SHELL),ne(),h=0,o="preview";const e=document.getElementById("focus"),s=document.getElementById("green-preview");if(s){s.classList.add("preview-scaled"),y=!0;const n=document.getElementById("silksong-video");n&&(n.muted=!1,n.play().catch(l=>{}))}e&&(e.classList.add("visible"),k()),Be&&Be.classList.add("slide-out");const i=document.getElementById("quick-resume");i&&i.classList.add("dismiss"),qe(),u.confirmation(),console.log("Lock screen unlocked! Shell interactions now active.")}function qe(){T===w.LOCKED&&(z=!1,Ee=0,R&&(R.style.transition="stroke-dashoffset 0.2s ease",R.style.strokeDashoffset="100.53"))}function ct(){if(T!==w.SHELL||!y||o!=="preview")return;const t=c.isDown("X");t&&!J?(J=!0,fe=Date.now(),console.log("X button hold started - will scale down preview in",ve+"ms")):t&&J?Date.now()-fe>=ve&&ft():!t&&J&&(Date.now()-fe<ve&&(console.log("X button quick tap detected - toggling overlay"),dt()),je())}function ft(){console.log("X button hold complete! Scaling down preview and reordering to leftmost position.");const e=E.map(s=>document.getElementById(`${s}-preview`))[h];if(e&&e.classList.contains("preview-scaled")){e.classList.remove("preview-scaled"),y=!1;const s=document.getElementById("silksong-video");if(s&&e.id==="green-preview"&&(s.muted=!0,s.pause()),Z){const l=document.getElementById("overlay");l&&(l.classList.remove("visible"),Z=!1,console.log("Overlay closed (preview scaled down)"))}const i=document.getElementById("running-apps");i&&i.classList.add("visible");const n=document.getElementById("shell-nav");if(n&&n.classList.add("visible"),h!==0){const l=D[h],r=E[h];D.splice(h,1),E.splice(h,1),D.unshift(l),E.unshift(r);const f=document.getElementById("running-apps");f&&(f.innerHTML="",D.forEach(g=>{g&&f.appendChild(g)})),h=0}Te(),ne(),k(),u.confirmation()}je()}function je(){J=!1,fe=0}function dt(){if(!y||o!=="preview"){console.log("Overlay can only be toggled when an app preview is fullscreen");return}const t=document.getElementById("overlay");if(t)if(Z=!Z,Z){const e=E[h];t.classList.add("visible"),t.classList.remove("show-gb","show-steam"),e==="green"||e==="blue"?(t.classList.add("show-gb"),console.log(`Overlay opened: GB interface for ${e} app`)):e==="orange"&&(t.classList.add("show-steam"),console.log(`Overlay opened: Steam interface for ${e} app`)),u.lightTap()}else t.classList.remove("visible","show-gb","show-steam"),console.log("Overlay closed"),u.lightTap()}function ut(){gt(),He()}function He(){const t=T!==w.LOCKED;Ae&&(Ae.className=t?"unlocked":"locked"),Q&&(t?Q.classList.add("slide-out"):Q.classList.remove("slide-out"))}function gt(){const t=new Date;let e=t.getHours();const s=t.getMinutes();e===0?e=12:e>12&&(e=e-12);const i=`${e}:${s.toString().padStart(2,"0")}`;Q&&(Q.textContent=i),De&&(De.textContent=i)}async function V(t=1,e=200){const s=c.firstGamepad();if(!s)return;const i=s.vibrationActuator;if(i)try{await i.playEffect("dual-rumble",{duration:e,strongMagnitude:t,weakMagnitude:t})}catch(n){console.warn("Rumble not supported:",n)}}const u={lightTap:()=>V(.2,50),confirmation:()=>V(.8,200),navigation:()=>V(.1,30),error:()=>V(.6,100),menuToggle:()=>V(.4,150),selectionChange:()=>V(.15,25)};function te(t){T=t;const e=document.getElementById("blur-container");e&&(t!==w.LOCKED?e.classList.add("visible"):e.classList.remove("visible")),He(),ne()}function G(t){const e=Oe();if(e.length===0)return;const s=E[h],i=e.indexOf(s);let n;t==="right"?n=(i+1)%e.length:t==="left"&&(n=(i-1+e.length)%e.length);const l=e[n];h=E.indexOf(l),ne(),u.selectionChange()}function $(t){t==="right"?b=(b+1)%ee.length:t==="left"&&(b=(b-1+ee.length)%ee.length),k(),u.selectionChange()}function ne(){T===w.SHELL&&(D.forEach((t,e)=>{t&&(e===h?(t.classList.add("app-active"),t.classList.remove("app-rest")):(t.classList.add("app-rest"),t.classList.remove("app-active")))}),Te())}function Te(){const t=Oe(),e=t.map(l=>document.getElementById(`${l}-preview`));E.forEach(l=>{const r=document.getElementById(`${l}-preview`);r&&r.classList.remove("preview-center","preview-left","preview-right","preview-far-left","preview-far-right","preview-scaled")}),y=!1;const s=t.length,i=E[h],n=t.indexOf(i);if(s===2)switch(n){case 0:e[0]?.classList.add("preview-center"),e[1]?.classList.add("preview-right");break;case 1:e[0]?.classList.add("preview-left"),e[1]?.classList.add("preview-center");break}else if(s===3)switch(n){case 0:e[0]?.classList.add("preview-center"),e[1]?.classList.add("preview-right"),e[2]?.classList.add("preview-far-right");break;case 1:e[0]?.classList.add("preview-left"),e[1]?.classList.add("preview-center"),e[2]?.classList.add("preview-right");break;case 2:e[0]?.classList.add("preview-far-left"),e[1]?.classList.add("preview-left"),e[2]?.classList.add("preview-center");break}k()}function Ne(){const e=E.map(s=>document.getElementById(`${s}-preview`))[h];if(e)if(y)console.log("Preview already scaled up. Use VIEW button hold to scale down.");else{if(e.classList.add("preview-scaled"),y=!0,e.id==="green-preview"){const n=document.getElementById("silksong-video");n&&(n.muted=!1,n.play().catch(l=>{}))}const s=document.getElementById("running-apps");s&&s.classList.remove("visible");const i=document.getElementById("shell-nav");i&&i.classList.remove("visible"),k(),u.confirmation()}}function k(){const t=document.getElementById("focus");if(t)if(t.classList.remove("focus-preview","focus-nav","focus-shell-surface","focus-shell-library","focus-shell-settings"),o==="preview"){we();const s=E.map(n=>document.getElementById(`${n}-preview`))[h];if(!s)return;s.classList.contains("preview-scaled")?(t.style.width="1280px",t.style.height="720px"):(t.style.width="648px",t.style.height="432px"),t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.classList.add("focus-preview")}else if(o==="shell-nav"){t.classList.add("focus-nav");const e=document.getElementById(ee[b]);if(!e)return;const s=e.getBoundingClientRect(),i=document.getElementById("windows-shell").getBoundingClientRect();t.style.width="64px",t.style.height="64px",t.style.top=`${s.top-i.top+s.height/2}px`,t.style.left=`${s.left-i.left+s.width/2}px`,t.style.transform="translate(-50%, -50%)",we(ee[b])}else o==="shell-surface"&&we()}function we(t=null){const e={library:document.getElementById("label-library"),settings:document.getElementById("label-settings"),notifications:document.getElementById("label-notifications"),gallery:document.getElementById("label-gallery")},s=document.getElementById("shell-nav");if(!t||!s){Object.values(e).forEach(S=>{S&&S.classList.remove("active","faded")});return}const i=document.getElementById(t);if(!i)return;const n=i.getBoundingClientRect(),l=s.getBoundingClientRect(),r=n.top-l.top,f=n.left-l.left,g=n.width;Object.entries(e).forEach(([S,m])=>{if(m)if(S===t){m.classList.add("active"),m.classList.remove("faded");const he=r-16-20,F=f+g/2;m.style.top=`${he}px`,m.style.left=`${F}px`,m.style.transform="translateX(-50%)"}else m.classList.remove("active"),m.classList.add("faded")})}function pt(){o=le.area,h=le.appIndex,b=le.navIndex;const t=document.getElementById("focus"),e=document.getElementById("shell-nav");t&&(t.style.opacity="1"),e&&(e.style.opacity="1"),k()}function H(){const t=document.getElementById("focus"),e=document.querySelector(".library-search-box"),s=document.querySelectorAll(".launcher-row-container"),i=document.querySelector(".library-content");if(!t)return;if(t.style.opacity="0",document.querySelectorAll(".launcher-app").forEach(l=>l.classList.remove("focused")),e&&e.classList.remove("focused"),p===-1){e&&e.classList.add("focused"),s.forEach(l=>{l.style.transition="transform 0.3s ease",l.style.transform="translateY(0)"});return}const n=s[p];if(n){const f=n.querySelector(".launchers").querySelectorAll(".launcher-app")[L];f&&f.classList.add("focused");const g=ae[p];if(g>5){let m=0;if(L>=3){m=-(L-2)*194;const F=-(g-5)*194;m=Math.max(m,F)}n.style.transition="transform 0.3s ease",n.style.transform=`translateX(${m}px) translateY(${p>=2?-264*(p-1):0}px)`}else n.style.transition="transform 0.3s ease",n.style.transform=`translateX(0) translateY(${p>=2?-264*(p-1):0}px)`}if(i){let l=0;p>=2&&(l=-264*(p-1)),s.forEach((r,f)=>{f!==p&&(r.style.transition="transform 0.3s ease",r.style.transform=`translateY(${l}px)`)}),e&&(e.style.transition="transform 0.3s ease",e.style.transform=`translateY(${l}px)`)}}function C(t){if(p===-1){t==="down"&&(p=0,L=0,H());return}const e=ae[p];t==="left"&&L>0?(L--,H()):t==="right"&&L<e-1?(L++,H()):t==="up"?p>0?(p--,L=Math.min(L,ae[p]-1),H()):p===0&&(p=-1,L=0,H()):t==="down"&&p<Ke-1&&(p++,L=Math.min(L,ae[p]-1),H())}function Ie(){const t=document.querySelectorAll(".nav-page-item");if(!(!t||t.length===0)&&(t.forEach(e=>e.classList.remove("focused")),t[q])){t[q].classList.add("focused");const e=document.querySelector(".settings-nav-pages");if(e)if(q>=2){const s=t[2];if(s){const i=s.offsetTop;e.scrollTo({top:i,behavior:"smooth"})}}else e.scrollTo({top:0,behavior:"smooth"})}}function M(t){t==="up"&&q>0?(q--,Ie()):t==="down"&&q<We-1?(q++,Ie()):t==="right"&&(document.querySelectorAll(".nav-page-item").forEach(s=>s.classList.remove("focused")),o="settings-display-controls",v=0,ue())}function ue(){const t=document.querySelectorAll(".section-settings"),e=[];if(t.forEach(s=>{const i=s.querySelector(".slider-control"),n=s.querySelectorAll(".cycle-selector");i&&e.push(i),n.forEach(l=>e.push(l))}),!(!e||e.length===0)&&(e.forEach(s=>{s&&s.classList.remove("focused")}),e[v])){e[v].classList.add("focused");const s=document.querySelector(".settings-content-container");if(v<=2)s&&s.scrollTo({top:0,behavior:"smooth"});else if(v>=6){const i=t[2];if(i&&s){const n=i.offsetTop;s.scrollTo({top:n,behavior:"smooth"})}}}}function N(t){if(t==="up"&&v>0)v--,ue();else if(t==="down"&&v<et-1)v++,ue();else if(t==="left"){const e=document.querySelectorAll(".section-settings"),s=[];e.forEach(i=>{const n=i.querySelector(".slider-control"),l=i.querySelectorAll(".cycle-selector");n&&s.push(n),l.forEach(r=>s.push(r))}),s.forEach(i=>{i&&i.classList.remove("focused")}),o="settings-nav",Ie()}}function _e(t){const e=t===0?0:t===3?1:2,i=document.querySelectorAll(".section-settings")[e];if(!i)return;const n=i.querySelector(".slider-knob"),l=i.querySelector(".slider-value"),r=re[e];n&&(n.style.left=`${r}%`),l&&(l.style.width=`${r}%`)}function be(t){const s={1:0,2:1,4:2,5:3,7:4,8:5}[t];if(s===void 0)return;const i=document.querySelectorAll(".section-settings"),n=[];i.forEach(f=>{f.querySelectorAll(".cycle-selector").forEach(S=>n.push(S))});const l=n[s];if(!l)return;const r=l.querySelector(".cycle-value");r&&(r.textContent=ce[W[s]])}function ke(){const t=document.querySelectorAll(".gallery-nav-pages .nav-page-item");!t||t.length===0||(t.forEach(e=>e.classList.remove("focused")),t[_]&&t[_].classList.add("focused"))}function P(t){t==="up"&&_>0?(_--,ke()):t==="down"&&_<ze-1?(_++,ke()):t==="right"&&(document.querySelectorAll(".gallery-nav-pages .nav-page-item").forEach(s=>s.classList.remove("focused")),o="gallery-media",x=0,j=0,X())}function X(){const t=document.querySelectorAll(".gallery-media-item");if(!t||t.length===0)return;t.forEach(s=>s.classList.remove("focused"));const e=x*Le+j;if(t[e]){t[e].classList.add("focused");const s=document.querySelector(".gallery-media-grid");if(s&&x>=2){const i=t[2*Le];if(i){const n=i.offsetTop;s.scrollTo({top:n-100,behavior:"smooth"})}}else s&&s.scrollTo({top:0,behavior:"smooth"})}}function O(t){t==="left"?j>0?(j--,X()):(o="gallery-nav",ke(),document.querySelectorAll(".gallery-media-item").forEach(s=>s.classList.remove("focused"))):t==="right"&&j<Le-1?(j++,X()):t==="up"&&x>0?(x--,X()):t==="down"&&x<Ze-1&&(x++,X())}function ge(){const t=document.querySelectorAll("#shell-notifications .nav-page-item"),e=document.querySelectorAll("#shell-notifications .notification");!t||t.length===0||(t.forEach(s=>s.classList.remove("focused")),e.forEach(s=>s.classList.remove("focused")),t[B]&&t[B].classList.add("focused"))}function Y(t){t==="up"&&B>0?(B--,ge()):t==="down"&&B<Je-1&&(B++,ge())}function se(){const t=document.querySelectorAll("#shell-notifications .notification"),e=document.querySelectorAll("#shell-notifications .nav-page-item"),s=document.querySelector("#shell-notifications .notifications-list");if(!(!t||t.length===0))if(t.forEach(i=>i.classList.remove("focused")),e.forEach(i=>i.classList.remove("focused")),t[I]&&t[I].classList.add("focused"),s&&I>=4){const i=t[4];if(i){const n=i.offsetTop;console.log(`Scrolling to notification ${I+1}, offsetTop: ${n}, scrollTo: ${n-72}`),s.scrollTo({top:n-72,behavior:"smooth"})}}else s&&I<=3&&(console.log(`Resetting scroll to top for notification ${I+1}`),s.scrollTo({top:0,behavior:"smooth"}))}function K(t){t==="up"&&I>0?(I--,se()):t==="down"&&I<Qe-1&&(I++,se())}function pe(t){le={area:o,navIndex:b,appIndex:h};const e=document.getElementById(`shell-${t}`),s=document.getElementById("focus"),i=document.getElementById("running-apps");if(!e)return;e.classList.add("visible"),i&&i.classList.remove("visible"),document.querySelectorAll(".preview-container").forEach(r=>{r.classList.add("hide-right")}),o="shell-surface",de=t;const l=document.getElementById("shell-nav");if(s&&(s.style.opacity="0"),l&&(l.style.opacity="0"),t==="library"&&(o="library-launchers",L=0,p=-1,H()),t==="settings"){o="settings-display-controls",v=0,ue();for(let g=0;g<3;g++)_e(g*3);[1,2,4,5,7,8].forEach(g=>{be(g)});const f=document.querySelectorAll(".settings-nav-pages .nav-page-item");f[0]&&f[0].classList.add("selected")}if(t==="gallery"){o="gallery-media",x=0,j=0,X();const r=document.querySelectorAll(".gallery-nav-pages .nav-page-item");r[0]&&r[0].classList.add("selected")}if(t==="notifications"){o="notifications-content",I=0,se();const r=document.querySelectorAll("#shell-notifications .nav-page-item");r[0]&&r[0].classList.add("selected")}}function ie(t){const e=document.getElementById(`shell-${t}`);document.getElementById("focus");const s=document.getElementById("running-apps");if(!e)return;e.classList.remove("visible"),s&&s.classList.add("visible"),document.querySelectorAll(".preview-container").forEach(n=>{n.classList.remove("hide-right")}),de=null,o==="library-launchers"&&(L=0,p=0,document.querySelectorAll(".launcher-app").forEach(n=>{n.classList.remove("focused")}),document.querySelectorAll(".launchers").forEach(n=>{n.style.transform="translateX(0) translateY(0)"})),(o==="settings-nav"||o==="settings-display-controls")&&(q=0,v=0,document.querySelectorAll(".nav-page-item").forEach(n=>{n.classList.remove("focused"),n.classList.remove("selected")}),document.querySelectorAll(".slider-control, .cycle-selector").forEach(n=>{n.classList.remove("focused")})),(o==="gallery-nav"||o==="gallery-media")&&(_=0,x=0,j=0,document.querySelectorAll(".gallery-nav-pages .nav-page-item").forEach(n=>{n.classList.remove("focused"),n.classList.remove("selected")}),document.querySelectorAll(".gallery-media-item").forEach(n=>{n.classList.remove("focused")})),(o==="notifications-nav"||o==="notifications-content")&&(B=0,I=0,document.querySelectorAll("#shell-notifications .nav-page-item").forEach(n=>{n.classList.remove("focused"),n.classList.remove("selected")}),document.querySelectorAll("#shell-notifications .notification").forEach(n=>{n.classList.remove("focused")})),pt()}function ht(){pe("library")}function Pe(){ie("library")}function mt(){pe("settings")}function yt(){ie("settings")}function vt(){pe("notifications")}function wt(){ie("notifications")}function Lt(){pe("gallery")}function Et(){ie("gallery")}function St(){const t=Date.now();(c.justPressed("LEFT")||c.isDown("LEFT")&&t-a>A)&&(o==="library-launchers"?(C("left"),a=t):o==="settings-nav"?(M("left"),a=t):o==="gallery-nav"?(P("left"),a=t):o==="gallery-media"?(O("left"),a=t):o==="settings-display-controls"?(N("left"),a=t):o==="notifications-content"?(o="notifications-nav",B=0,ge(),a=t):o!=="shell-surface"&&(o==="preview"&&!y?G("left"):o==="shell-nav"&&$("left"),a=t)),(c.justPressed("RIGHT")||c.isDown("RIGHT")&&t-a>A)&&(o==="library-launchers"?(C("right"),a=t):o==="settings-nav"?(M("right"),a=t):o==="gallery-nav"?(P("right"),a=t):o==="gallery-media"?(O("right"),a=t):o==="settings-display-controls"?(N("right"),a=t):o==="notifications-nav"?(o="notifications-content",I=0,se(),a=t):o!=="shell-surface"&&(o==="preview"&&!y?G("right"):o==="shell-nav"&&$("right"),a=t)),(c.justPressed("LB")||c.isDown("LB")&&t-a>A)&&o!=="shell-surface"&&(o==="preview"&&!y?G("left"):o==="shell-nav"&&$("left"),a=t),(c.justPressed("RB")||c.isDown("RB")&&t-a>A)&&o!=="shell-surface"&&(o==="preview"&&!y?G("right"):o==="shell-nav"&&$("right"),a=t);const e=c.getStick("LEFT"),s=Date.now();e.magnitude>d&&s-a>A&&(o==="library-launchers"?e.x>d?(C("right"),a=s):e.x<-d&&(C("left"),a=s):o==="settings-nav"?e.x>d&&(M("right"),a=s):o==="gallery-nav"?e.x>d&&(P("right"),a=s):o==="gallery-media"?e.x>d?(O("right"),a=s):e.x<-d&&(O("left"),a=s):o==="settings-display-controls"?e.x<-d&&(N("left"),a=s):o==="notifications-nav"?e.x>d&&(o="notifications-content",I=0,se(),a=s):o==="notifications-content"?e.x<-d&&(o="notifications-nav",B=0,ge(),a=s):o!=="shell-surface"&&(e.x>d?(o==="preview"&&!y?G("right"):o==="shell-nav"&&$("right"),a=s):e.x<-d&&(o==="preview"&&!y?G("left"):o==="shell-nav"&&$("left"),a=s))),e.magnitude>d&&s-a>A&&(o==="library-launchers"?e.y>d?(C("up"),a=s):e.y<-d&&(C("down"),a=s):o==="settings-nav"?e.y>d?(M("up"),a=s):e.y<-d&&(M("down"),a=s):o==="gallery-nav"?e.y>d?(P("up"),a=s):e.y<-d&&(P("down"),a=s):o==="notifications-nav"?e.y>d?(Y("up"),a=s):e.y<-d&&(Y("down"),a=s):o==="notifications-content"?e.y>d?(K("up"),a=s):e.y<-d&&(K("down"),a=s):o==="gallery-media"?e.y>d?(O("up"),a=s):e.y<-d&&(O("down"),a=s):o==="settings-display-controls"?e.y>d?(N("up"),a=s):e.y<-d&&(N("down"),a=s):o!=="shell-surface"&&(e.y>d?o==="shell-nav"&&!y&&(o="preview",k(),a=s):e.y<-d&&o==="preview"&&!y&&(o="shell-nav",k(),a=s))),(c.justPressed("DOWN")||c.isDown("DOWN")&&t-a>A)&&(o==="library-launchers"?(C("down"),a=t):o==="settings-nav"?(M("down"),a=t):o==="gallery-nav"?(P("down"),a=t):o==="notifications-nav"?(Y("down"),a=t):o==="notifications-content"?(K("down"),a=t):o==="gallery-media"?(O("down"),a=t):o==="settings-display-controls"?(N("down"),a=t):o!=="shell-surface"&&o==="preview"&&!y&&(o="shell-nav",k(),a=t)),(c.justPressed("UP")||c.isDown("UP")&&t-a>A)&&(o==="library-launchers"?(C("up"),a=t):o==="settings-nav"?(M("up"),a=t):o==="gallery-nav"?(P("up"),a=t):o==="notifications-nav"?(Y("up"),a=t):o==="notifications-content"?(K("up"),a=t):o==="gallery-media"?(O("up"),a=t):o==="settings-display-controls"?(N("up"),a=t):o!=="shell-surface"&&o==="shell-nav"&&!y&&(o="preview",k(),a=t)),(c.justPressed("DOWN")||c.isDown("DOWN")&&t-a>A)&&(o==="settings-nav"?(M("down"),a=t):o==="gallery-nav"?(P("down"),a=t):o==="notifications-nav"?(Y("down"),a=t):o==="notifications-content"?(K("down"),a=t):o==="settings-display-controls"&&(N("down"),a=t)),y&&o==="preview"&&(c.getStick("LEFT").magnitude>d,c.justPressed("UP"),c.justPressed("DOWN"),c.justPressed("LEFT"),c.justPressed("RIGHT"));const i=Date.now();if(c.isDown("A")&&i-Ce>tt){if(me)return;if(Ce=i,o==="library-launchers")if(p===0&&L===1){if(Me){u.lightTap();return}me=!0,Me=!0,Pe(),setTimeout(()=>{const l=document.getElementById("orange"),r=document.getElementById("orange-preview");l&&l.classList.remove("hidden-app"),r&&(r.classList.remove("hidden-app"),r.classList.add("slide-in-left")),h=2;const f=D[h],g=E[h];D.splice(h,1),E.splice(h,1),D.unshift(f),E.unshift(g);const S=document.getElementById("running-apps");S&&(S.innerHTML="",D.forEach(m=>{m&&S.appendChild(m)})),h=0,ne(),Te(),setTimeout(()=>{r&&r.classList.remove("slide-in-left"),o="preview",k(),setTimeout(()=>{Ne(),setTimeout(()=>{me=!1},400)},400)},600)},100),u.confirmation()}else u.confirmation();else o==="preview"?Ne():o==="shell-nav"?b===0?(ht(),u.confirmation()):b===1?(mt(),u.confirmation()):b===2?(Lt(),u.confirmation()):b===3&&(vt(),u.confirmation()):o==="shell-surface"&&u.lightTap()}if(c.justPressed("B")){const l=document.getElementById("shell-library"),r=document.getElementById("shell-settings"),f=document.getElementById("shell-notifications"),g=document.getElementById("shell-gallery");l&&l.classList.contains("visible")?(Pe(),u.lightTap()):r&&r.classList.contains("visible")?(yt(),u.lightTap()):f&&f.classList.contains("visible")?(wt(),u.lightTap()):(g&&g.classList.contains("visible")&&Et(),u.lightTap())}c.justPressed("Y")&&u.lightTap(),c.justPressed("LT")&&u.menuToggle(),c.justPressed("RT")&&u.menuToggle();const n=c.getStick("RIGHT");if(o==="settings-display-controls"&&[0,3,6].includes(v)){if(n.magnitude>ot){const l=v===0?0:v===3?1:2,r=2;re[l]+=n.x*r,re[l]=Math.max(0,Math.min(100,re[l])),_e(v)}}else if(o==="settings-display-controls"&&[1,2,4,5,7,8].includes(v)){const l=Date.now();if(n.magnitude>d&&l-ye>st){const f={1:0,2:1,4:2,5:3,7:4,8:5}[v];n.x>d?(W[f]=(W[f]+1)%ce.length,be(v),ye=l):n.x<-d&&(W[f]=(W[f]-1+ce.length)%ce.length,be(v),ye=l)}}c.justPressed("LS")&&u.lightTap(),c.justPressed("RS")&&u.lightTap(),c.justPressed("MENU")&&(console.log("Shell: Opening main menu"),te(w.MENU),u.menuToggle())}function It(){console.log("Menu inputs active - navigating menu system!"),c.justPressed("UP")&&(console.log("Menu: Navigate up"),u.selectionChange()),c.justPressed("DOWN")&&(console.log("Menu: Navigate down"),u.selectionChange()),c.justPressed("A")&&(console.log("Menu: Select item"),u.confirmation()),c.justPressed("B")&&(console.log("Menu: Back to shell"),te(w.SHELL),u.menuToggle()),c.justPressed("MENU")&&(console.log("Menu: Closing menu"),te(w.SHELL),u.menuToggle())}function bt(){console.log("App inputs active - app-specific controls!"),c.justPressed("B")&&(console.log("App: Back to shell"),te(w.SHELL),u.lightTap())}requestAnimationFrame(Re);
